import{m as e,a as t}from"../../pinia-CTzb92xA.min.js";import s from"@/stores/PaymentStores/AdyenStore";import a from"@/stores/CartStore";import o from"@/stores/ConfigStores/ConfigStore";import n from"@/stores/CustomerStore";import r from"@/stores/StepsStore";import{r as i}from"../../index-Dc8nEF8k.min.js";import d from"@/components/Steps/CustomerInfoPage/Addresses/SavedDeliveryAddess/SavedDeliveryAddess.vue";import c from"@/components/Steps/PaymentPage/SavedShippingMethod/SavedShippingMethod.vue";import m from"@/services/payments/createPaymentGraphQl";import h from"@/services/adyen/getAdyenPaymentStatus";import p from"@/services/adyen/getAdyenPaymentDetails";import l from"@/services/customer/refreshCustomerData";import y from"@/helpers/payment/getAdyenProductionMode";import u from"@/helpers/payment/formatPrice";import g from"@/helpers/cart/getCartSectionNames";import _ from"@/helpers/payment/getPaymentExtensionAttributes";import f from"@/helpers/storeConfigs/getUrlQuery";import S from"@/helpers/cart/getSuccessPageUrl";import{c as v,a as k,b as A,t as P,o as C,p as w,d as b,r as M}from"../../runtime-core.esm-bundler-D9EqWZvo.min.js";var D={name:"AdyenAmazonReview",components:{SavedDeliveryAddress:d,SavedShippingMethod:c},data:()=>({orderId:null,state:"loading",errorMessage:""}),computed:{...e(s,["getAdyenClientKey"]),...e(a,["cartGrandTotal"]),...e(o,["currencyCode","locale","storeCode"]),...e(n,["customer","getSelectedBillingAddress"]),formattedTotal(){return u(this.cartGrandTotal/100)}},async created(){const e=f("amazonCheckoutSessionId");await this.getInitialConfig(),await this.getCart();const t=await this.getPaymentMethodsResponse(),s=_(),a={paymentMethodsResponse:t,clientKey:this.getAdyenClientKey,amount:{value:this.cartGrandTotal,currency:this.currencyCode},locale:this.locale,environment:y()?"live":"test",analytics:{enabled:!1},onAdditionalDetails:this.handleAdditionalDetails.bind(this),onSubmit:(e,t)=>{this.state="loading";const a=this.getPaymentMethod(e,s),o={billingAddress:this.getSelectedBillingAddress,paymentMethod:a,email:this.customer.email};m(o).then(this.setOrderId).then(h).then((e=>this.handlePaymentStatus(e,t))).catch((e=>{this.displayError(e.response?.data?.message)}))},paymentMethodsConfiguration:{threeDS2:{challengeWindowSize:"05"}}},o={amazonCheckoutSessionId:e,showOrderButton:!1},n=(await i(a)).create("amazonpay",o).mount("#amazonpay_order-container");window.amazonPayComponent=n,n.submit()},methods:{...t(s,["getPaymentMethodsResponse"]),...t(a,["getCart"]),...t(o,["getInitialConfig"]),setOrderId(e){return this.orderId=e,e},async handleAdditionalDetails(e,t){try{this.state="loading",document.body.classList.remove("gene-checkout-threeds-opened");const s=e.data?e.data:{};s.orderId=this.orderId;const a=await p(JSON.stringify(s));await this.handlePaymentStatus(a,t)}catch(e){const t=e.response?.data?.message;this.displayError(t)}},getPaymentMethod:(e,t)=>({method:"scheme"===e.data.paymentMethod.type?"adyen_cc":"adyen_hpp",additional_data:{brand_code:e.data.paymentMethod.type,stateData:JSON.stringify(e.data),is_active_payment_token_enabler:!!e.data.storePaymentMethod},extension_attributes:t}),async handlePaymentStatus(e,t){if(e.isFinal){["Authorised","Received","PresentToShopper"].includes(e.resultCode)?(this.state="success",await l(g()),setTimeout((()=>this.redirectToSuccess()),3e3)):this.displayError(e.message)}else e.action&&("threeDS2"===e.action.type&&document.body.classList.add("gene-checkout-threeds-opened"),t.handleAction(e.action))},redirectToSuccess(){window.location.href=S()},displayError(e=this.$t("errorMessages.unexpectedPaymentError")){this.state="error",this.errorMessage=e,setTimeout((()=>{r().goToPayment(),window.history.replaceState({},"","/checkout/#/payments")}),3e3)}}};const I=e=>(w("data-v-75f05062"),e=e(),b(),e),z={class:"payment-step"},T={class:"payment-page"},x={class:"payment-form"},R=I((()=>A("div",{id:"amazonpay_order-container"},null,-1))),E={key:0,class:"adyen-checkout__button adyen-checkout__button--pay adyen-checkout__button--loading",type:"button",disabled:""},O=[I((()=>A("div",{class:"adyen-checkout__spinner__wrapper"},[A("div",{class:"adyen-checkout__spinner adyen-checkout__spinner--medium"})],-1)))],G={key:1,class:"adyen-checkout__status adyen-checkout__status--error"},j=I((()=>A("img",{class:"adyen-checkout__status__icon adyen-checkout__image adyen-checkout__image--loaded",src:"https://checkoutshopper-test.adyen.com/checkoutshopper/images/components/error.gif",alt:"An unknown error occurred",height:"88"},null,-1))),B={class:"adyen-checkout__status__text"},K={key:2,class:"adyen-checkout__status adyen-checkout__status--success"},N=I((()=>A("img",{height:"88",class:"adyen-checkout__status__icon adyen-checkout__image adyen-checkout__image--loaded",src:"https://checkoutshopper-test.adyen.com/checkoutshopper/images/components/success.gif",alt:"Payment Successful"},null,-1))),J={class:"adyen-checkout__status__text"};D.render=function(e,t,s,a,o,n){const r=M("SavedDeliveryAddress"),i=M("SavedShippingMethod");return C(),v("div",z,[k(r),k(i),A("div",T,[A("div",x,[R,"loading"===o.state?(C(),v("button",E,[...O])):"error"===o.state?(C(),v("div",G,[j,A("span",B,P(o.errorMessage),1)])):(C(),v("div",K,[N,A("span",J,P(e.$t("adyen.paymentSuccessful")),1)]))])])])},D.__scopeId="data-v-75f05062",D.__file="src/components/AmazonReview/AmazonReview.vue";export{D as default};
