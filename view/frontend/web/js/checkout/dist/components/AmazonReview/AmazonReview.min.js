import{m as e,g as t,a,u as s}from"../../AdyenStore-aSQPAtTM.min.js";import{o as n}from"../../index-CQ188U4T.min.js";import{g as o}from"../../getAdyenPaymentStatus-CwxFgyq2.min.js";import{g as i}from"../../getAdyenPaymentDetails-CypUszLZ.min.js";import{l as d,c as r,a as c,r as h,b as l,t as u,o as y,p as m,d as p}from"../../loadFromCheckout-Cy42nNSj.min.js";var _={name:"AdyenAmazonReview",data:()=>({orderId:null,state:"loading",errorMessage:"",SavedDeliveryAddress:null,SavedShippingMethod:null}),computed:{...e(s,["getAdyenClientKey","isAdyenVersion"])},async created(){const[e,a,s,i,r,c]=await d(["components.SavedDeliveryAddress","components.SavedShippingMethod","helpers.getUrlQuery","services.createPaymentGraphQl","stores.useCartStore","stores.useConfigStore"]);this.SavedDeliveryAddress=e,this.SavedShippingMethod=a;const h=s("amazonCheckoutSessionId");await c.getInitialConfig(),await this.getInitialConfigValues(),await r.getCart();const l={paymentMethodsResponse:await this.getPaymentMethodsResponse(),clientKey:await this.getAdyenClientKey,amount:{value:r.cartGrandTotal,currency:c.currencyCode},locale:c.locale,environment:t()?"live":"test",analytics:{enabled:!1},onAdditionalDetails:this.handleAdditionalDetails.bind(this),onSubmit:(e,t)=>{this.state="loading";const a=this.getPaymentMethod(e);i(a).then(this.setOrderId).then(o).then((e=>this.handlePaymentStatus(e,t))).catch((e=>{this.displayError(e.response?.data?.message)}))},paymentMethodsConfiguration:{threeDS2:{challengeWindowSize:"05"}}},u={amazonCheckoutSessionId:h,showOrderButton:!1},y=(await n(l)).create("amazonpay",u).mount("#amazonpay_order-container");window.amazonPayComponent=y,y.submit()},methods:{...a(s,["getInitialConfigValues","getPaymentMethodsResponse"]),setOrderId(e){return this.orderId=e,e},async handleAdditionalDetails(e,t){try{this.state="loading",document.body.classList.remove("gene-checkout-threeds-opened");const a=e.data?e.data:{};a.orderId=this.orderId;const s=await i(JSON.stringify(a));await this.handlePaymentStatus(s,t)}catch(e){const t=e.response?.data?.message;this.displayError(t)}},getPaymentMethod(e){const t=this.isAdyenVersion("9")?"adyen_additional_data":"adyen_additional_data_hpp";return{code:this.isAdyenVersion("9")?"adyen_amazonpay":"adyen_hpp",[t]:{brand_code:e.data.paymentMethod.type,stateData:JSON.stringify(e.data)}}},async handlePaymentStatus(e,t){if(e.isFinal){if(["Authorised","Received","PresentToShopper"].includes(e.resultCode)){const[e,t]=await d(["helpers.getCartSectionNames","services.refreshCustomerData"]);this.state="success",await t(e()),setTimeout((()=>this.redirectToSuccess()),3e3)}else this.displayError(e.message)}else e.action&&("threeDS2"===e.action.type&&document.body.classList.add("gene-checkout-threeds-opened"),t.handleAction(e.action))},async redirectToSuccess(){const[e]=await d(["helpers.getSuccessPageUrl"]);window.location.href=e()},displayError(e=this.$t("errorMessages.unexpectedPaymentError")){this.state="error",this.errorMessage=e,setTimeout((async()=>{const[e]=await d(["stores.useStepsStore"]);e.goToPayment(),window.history.replaceState({},"","/checkout/#/payments")}),3e3)}}};const g=e=>(m("data-v-75f05062"),e=e(),p(),e),S={class:"payment-step"},v={class:"payment-page"},k={class:"payment-form"},f=g((()=>l("div",{id:"amazonpay_order-container"},null,-1))),w={key:0,class:"adyen-checkout__button adyen-checkout__button--pay adyen-checkout__button--loading",type:"button",disabled:""},A=[g((()=>l("div",{class:"adyen-checkout__spinner__wrapper"},[l("div",{class:"adyen-checkout__spinner adyen-checkout__spinner--medium"})],-1)))],C={key:1,class:"adyen-checkout__status adyen-checkout__status--error"},P=g((()=>l("img",{class:"adyen-checkout__status__icon adyen-checkout__image adyen-checkout__image--loaded",src:"https://checkoutshopper-test.adyen.com/checkoutshopper/images/components/error.gif",alt:"An unknown error occurred",height:"88"},null,-1))),M={class:"adyen-checkout__status__text"},b={key:2,class:"adyen-checkout__status adyen-checkout__status--success"},D=g((()=>l("img",{height:"88",class:"adyen-checkout__status__icon adyen-checkout__image adyen-checkout__image--loaded",src:"https://checkoutshopper-test.adyen.com/checkoutshopper/images/components/success.gif",alt:"Payment Successful"},null,-1))),I={class:"adyen-checkout__status__text"};_.render=function(e,t,a,s,n,o){return y(),r("div",S,[(y(),c(h(n.SavedDeliveryAddress))),(y(),c(h(n.SavedShippingMethod))),l("div",v,[l("div",k,[f,"loading"===n.state?(y(),r("button",w,[...A])):"error"===n.state?(y(),r("div",C,[P,l("span",M,u(n.errorMessage),1)])):(y(),r("div",b,[D,l("span",I,u(e.$t("adyen.paymentSuccessful")),1)]))])])])},_.__scopeId="data-v-75f05062",_.__file="src/components/AmazonReview/AmazonReview.vue";export{_ as default};
